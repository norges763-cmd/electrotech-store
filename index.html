<!DOCTYPE html>
<html lang="es">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PKPRZS8BVW"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-PKPRZS8BVW');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum- –Ω–∞–¥–µ–∂–Ω—ã–π.0, user-scalable=yes">
    <meta name="theme-color" content="#1a1a2e">
    <title>Mi tienda online</title>
    <style>
        :root {
            --primary: #1a1a2e;
            --accent: #2ecc71;
            --whatsapp: #25d366;
            --danger: #e74c3c;
            --info: #34495e;
            --warning-bg: #fff3cd;
            --warning-text: #856404;
        }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            background: #f8f9fa; 
            -webkit-tap-highlight-color: transparent; 
            padding-bottom: 100px; 
        }

        header { 
            background: var(--primary); 
            color: white; 
            padding: 30px 15px; 
            text-align: center; 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
        }

        .aviso-precios {
            background-color: var(--warning-bg);
            color: var(--warning-text);
            padding: 12px 20px;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            border-bottom: 1px solid #ffeeba;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .seccion-compartir { 
            text-align: center; 
            padding: 40px 15px; 
            background: #f0f0f0; 
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px; 
        }
        
        .btn-final-copiar { 
            background: var(--info); 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 30px; 
            font-size: 14px; 
            font-weight: bold; 
            cursor: pointer; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
        }

        .btn-final-compartir { 
            background: var(--primary); 
            color: white; 
            border: none; 
            width: 45px; 
            height: 45px; 
            border-radius: 50%; 
            font-size: 18px; 
            font-weight: bold; 
            cursor: pointer; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .seccion-peticion { 
            padding: 25px 15px; 
            background: white; 
            margin: 20px 15px; 
            border-radius: 15px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
            text-align: center; 
        }
        
        .seccion-peticion h2 { 
            font-size: 18px; 
            color: var(--primary); 
            margin-bottom: 5px; 
        }
        
        .seccion-peticion p { 
            font-size: 14px; 
            color: #666; 
            margin-bottom: 15px; 
            line-height: 1.4; 
        }
        
        .input-peticion { 
            width: 100%; 
            border: 1.5px solid #ddd; 
            border-radius: 10px; 
            padding: 12px; 
            font-family: inherit; 
            font-size: 14px; 
            box-sizing: border-box; 
            margin-bottom: 15px; 
            resize: none; 
        }
        
        .btn-peticion { 
            background: var(--whatsapp); 
            color: white; 
            border: none; 
            padding: 12px 25px; 
            border-radius: 10px; 
            font-weight: bold; 
            cursor: pointer; 
            width: 100%; 
            font-size: 15px; 
        }

        .filtros { 
            display: flex; 
            overflow-x: auto; 
            gap: 10px; 
            padding: 20px 15px; 
            scrollbar-width: none; 
        }
        
        .filtros::-webkit-scrollbar { 
            display: none; 
        }
        
        .btn-filtro { 
            padding: 10px 22px; 
            border: 1.5px solid var(--primary); 
            border-radius: 25px; 
            background: white; 
            white-space: nowrap; 
            font-weight: bold; 
            font-size: 14px; 
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.4; 
            color: var(--primary);
        }

        .btn-filtro.activo { 
            background: var(--primary); 
            color: white; 
            opacity: 1; 
            transform: scale(1.05); 
            box-shadow: 0 4px 10px rgba(26, 26, 46, 0.2);
        }

        .tienda { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            padding: 15px; 
        }
        
        .producto { 
            background: white; 
            border-radius: 15px; 
            padding: 15px; 
            text-align: center; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
            display: flex; 
            flex-direction: column; 
            justify-content: space-between; 
            position: relative; 
        }

        .img-container { 
            width: 100%; 
            height: 130px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin-bottom: 10px; 
            position: relative; 
        }
        
        .img-container img { 
            max-width: 100%; 
            max-height: 100%; 
            object-fit: contain; 
            border-radius: 8px; 
            cursor: pointer; 
        }
        
        .badge-fotos { 
            position: absolute; 
            bottom: 5px; 
            right: 5px; 
            background: rgba(0,0,0,0.7); 
            color: white; 
            font-size: 10px; 
            padding: 3px 8px; 
            border-radius: 10px; 
            font-weight: bold; 
            pointer-events: none; 
        }

        h3 { 
            font-size: 15px; 
            margin: 10px 0 5px 0; 
            color: #333; 
            height: 40px; 
            overflow: hidden; 
        }
        
        .precio { 
            font-size: 16px; 
            color: var(--accent); 
            font-weight: bold; 
            margin-bottom: 12px; 
            display: block; 
        }
        
        .btn-whatsapp { 
            background: var(--whatsapp); 
            color: white; 
            border: none; 
            padding: 10px; 
            border-radius: 10px; 
            font-size: 13px; 
            font-weight: bold; 
            display: block; 
            width: 100%;
            margin-top: 5px; 
            cursor: pointer;
        }

        .btn-descripcion { 
            background: var(--info); 
            color: white; 
            border: none; 
            padding: 10px; 
            border-radius: 10px; 
            font-size: 12px; 
            font-weight: bold; 
            cursor: pointer; 
            width: 100%; 
        }
        
        .btn-agotado { 
            background: var(--danger); 
            color: white; 
            border: none; 
            padding: 10px; 
            border-radius: 10px; 
            font-size: 13px; 
            font-weight: bold; 
            opacity: 0.9; 
            width: 100%; 
            margin-top: 5px; 
            cursor: not-allowed; 
        }

        .modal { 
            display: none; 
            position: fixed; 
            z-index: 9999; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.95); 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
        }
        
        .modal.modo-texto { 
            background: white; 
        }
        
        .modal.modo-texto .btn-cerrar { 
            color: #333; 
            background: rgba(0,0,0,0.1); 
        }
        
        .modal.modo-texto .modal-text { 
            color: #333; 
        }

        .carrusel-container { 
            width: 100%; 
            display: flex; 
            overflow-x: auto; 
            scroll-snap-type: x mandatory; 
            scrollbar-width: none; 
            -webkit-overflow-scrolling: touch; 
        }
        
        .carrusel-item { 
            min-width: 100%; 
            width: 100%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            scroll-snap-align: center; 
            scroll-snap-stop: always; 
        }
        
        .carrusel-item img { 
            width: 100%; 
            max-height: 85vh; 
            object-fit: contain; 
        }
        
        .modal-text { 
            color: white; 
            padding: 25px; 
            text-align: center; 
            max-width: 85%; 
        }
        
        .modal-text h2 { 
            color: var(--accent); 
            margin-top: 0; 
            margin-bottom: 15px; 
        }
        
        .modal-text p { 
            font-size: 17px; 
            line-height: 1.6; 
            margin: 0; 
        }

        .btn-cerrar { 
            position: absolute; 
            top: 30px; 
            right: 30px; 
            color: white; 
            font-size: 40px; 
            cursor: pointer; 
            z-index: 10001; 
            background: rgba(255,255,255,0.1); 
            width: 45px; 
            height: 45px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            border-radius: 50%; 
        }
        
        .instruccion { 
            color: white; 
            margin-top: 20px; 
            font-size: 14px; 
            opacity: 0.8; 
            background: rgba(255,255,255,0.1); 
            padding: 5px 15px; 
            border-radius: 20px; 
        }

        .selector-contenido {
            width: 90%;
            max-width: 800px;
            background: white;
            border-radius: 15px;
            padding: 0;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .selector-titulo {
            color: var(--primary);
            text-align: center;
            margin: 20px 0 10px 0;
            font-size: 20px;
            padding: 0 15px;
        }

        .carrito-flotante {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--accent);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 9999;
            transition: transform 0.2s;
        }
        
        .carrito-flotante:active { 
            transform: scale(0.9); 
        }
        
        .contador-carrito {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            font-size: 12px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 50%;
            border: 2px solid white;
        }

        #modalCarrito {
            background: white;
            justify-content: flex-start;
            padding-top: 60px;
            overflow-y: auto;
        }
        
        .carrito-contenido {
            width: 90%;
            max-width: 500px;
            background: white;
            padding: 20px;
            padding-bottom: 100px;
        }
        
        .item-carrito {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        
        .item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .item-info img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 5px;
            border: 1px solid #eee;
        }
        
        .item-detalles h4 { 
            margin: 0; 
            font-size: 14px; 
            color: #333; 
        }
        
        .item-detalles span { 
            font-size: 12px; 
            color: #777; 
        }
        
        .btn-eliminar { 
            color: var(--danger); 
            cursor: pointer; 
            font-size: 20px; 
            padding: 0 10px; 
            background: none; 
            border: none; 
        }
        
        .carrito-total {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            text-align: right;
            border-top: 2px solid #eee;
            padding-top: 15px;
        }
        
        .btn-pedir-todo {
            background: var(--whatsapp);
            color: white;
            border: none;
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 12px;
            margin-top: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .fly-img {
            position: fixed;
            z-index: 10000;
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            opacity: 0.8;
            pointer-events: none;
            transition: all 0.8s cubic-bezier(0.19, 1, 0.22, 1);
        }
    </style>
</head>
<body>

<header>
    <h1 style="margin:0; font-size: 28px; letter-spacing: 1px;">Mi tienda online</h1>
</header>

<div class="aviso-precios">
    <span>‚ö†Ô∏è Algunos precios pueden variar debido a la constante fluctuaci√≥n del USD</span>
</div>

<div class="filtros">
    <button class="btn-filtro activo" onclick="filtrar('todos', this)">Todos</button>
    <button class="btn-filtro" onclick="filtrar('conectividad', this)">Accesorios para tel√©fonos</button>
    <button class="btn-filtro" onclick="filtrar('almacenamiento', this)">Almacenamiento</button>
    <button class="btn-filtro" onclick="filtrar('pc', this)">Componentes para PC</button>
    <button class="btn-filtro" onclick="filtrar('otros', this)">Otros</button>
</div>

<div id="miModal" class="modal">
    <span class="btn-cerrar" onclick="cerrarModal()">&times;</span>
    <div class="carrusel-container" id="carrusel"></div>
    <p id="txtInstruccion" class="instruccion">Desliza suavemente</p>
</div>

<div id="modalCarrito" class="modal modo-texto">
    <span class="btn-cerrar" style="color:#333; background:rgba(0,0,0,0.1);" onclick="cerrarCarrito()">&times;</span>
    <div class="carrito-contenido">
        <h2 style="color: var(--primary);">Tu Carrito</h2>
        <div id="listaCarrito">
            <p style="text-align:center; color:#777; margin-top:50px;">El carrito est√° vac√≠o</p>
        </div>
        <div id="resumenCarrito" style="display:none;">
            <div class="carrito-total">Total estimado: $<span id="totalPrecio">0</span></div>
            <button class="btn-pedir-todo" onclick="enviarPedidoWhatsApp()">
                WhatsApp (Enviar Pedido)
            </button>
        </div>
    </div>
</div>

<div class="carrito-flotante" id="btnCarritoFlotante" onclick="abrirCarrito()">
    üõí
    <span class="contador-carrito" id="contadorCarrito">0</span>
</div>

<div class="tienda" id="productosContainer"></div>

<div class="seccion-peticion">
    <h2>¬øQu√© necesitas?</h2>
    <p>Si necesitas otro producto que no est√° en la tienda, por favor haz un comentario, y se tendr√° en cuenta.</p>
    <textarea id="textoPeticion" class="input-peticion" placeholder="Escribe aqu√≠ el producto que buscas..." rows="3"></textarea>
    <button class="btn-peticion" onclick="enviarPeticion()">Enviar a WhatsApp</button>
</div>

<div class="seccion-compartir">
    <button class="btn-final-copiar" onclick="copiarAlPortapapeles(window.location.href)">
        Copiar enlace
    </button>
    <button class="btn-final-compartir" onclick="compartirTienda()">
        &#10150;
    </button>
</div>

<script>
    // ==========================================
    // √ÅREA DE EDICI√ìN DE PRODUCTOS
    // ==========================================

    const productosData = [
        {
            nombre: "Micros SD de 64gb",
            precio: "$2500 CUP",
            categoria: "conectividad",
            fotos: ["https://i.ibb.co/gMqH6nfn/Lumii-20250921-192528087.jpg"],
            descripcion: "",
            disponible: false
        },
        {
            nombre: "Cargadores",
            precio: "Desde $750 CUP",
            categoria: "conectividad",
            fotos: ["https://i.ibb.co/KjY3KDTV/Lumii-20251209-160415678.jpg", "https://i.ibb.co/PsBRYb20/1000218217.jpg"],
            descripcion: "Cargadores est√°ndar y de doble puerto.",
            disponible: true,
            variantes: [
                {nombre: "Cargador Doble Puerto", precio: "$1800 CUP", img: "https://i.ibb.co/KjY3KDTV/Lumii-20251209-160415678.jpg", disponible: false},
                {nombre: "Cargador 5V a 1A", precio: "$750 CUP", img: "https://i.ibb.co/PsBRYb20/1000218217.jpg", disponible: true}
            ]
        },
        {
            nombre: "Power banks",
            precio: "---",
            categoria: "conectividad",
            fotos: [
                "https://i.ibb.co/mVZXcbVH/1000223219.jpg", "https://i.ibb.co/ccrSKPJH/1000223220.jpg",
                "https://i.ibb.co/sJCtB30M/1000223221.jpg", "https://i.ibb.co/xSMb89yF/1000223222.jpg",
                "https://i.ibb.co/WWsK8krj/1000223223.jpg"
            ],
            descripcion: "Bater√≠as port√°tiles de alta capacidad.",
            disponible: false
        },
        {
            nombre: "Cables USB",
            precio: "Desde $500 CUP",
            categoria: "conectividad",
            fotos: ["https://i.ibb.co/C3B0YzFm/Lumii-20251209-115131565.jpg", "https://i.ibb.co/HpdRBhm1/1000218191.jpg", "https://i.ibb.co/23FmktSZ/1000217879.jpg"],
            descripcion: "Cables de datos y carga (Tipo C, Tipo B, C a C).",
            disponible: true,
            variantes: [
                {nombre: "Cable Tipo C a Tipo C", precio: "$580 CUP", img: "https://i.ibb.co/C3B0YzFm/Lumii-20251209-115131565.jpg", disponible: false},
                {nombre: "Cable Tipo C a USB", precio: "$500 CUP", img: "https://i.ibb.co/23FmktSZ/1000217879.jpg", disponible: true},
                {nombre: "Cable Tipo B (Micro)", precio: "$700 CUP", img: "https://i.ibb.co/HpdRBhm1/1000218191.jpg", disponible: true}
            ]
        },
        {
            nombre: "Adaptadores OTG",
            precio: "Desde $230 CUP",
            categoria: "conectividad",
            fotos: ["https://i.ibb.co/Ng76BvzN/Lumii-20251004-131401596.jpg", "https://i.ibb.co/SD0SWwyx/OTG-Tipo-B.jpg"],
            descripcion: "Conecta USB a tu tel√©fono (Tipo C y Micro USB).",
            disponible: true,
            variantes: [
                {nombre: "OTG Tipo C", precio: "$230 CUP", img: "https://i.ibb.co/Ng76BvzN/Lumii-20251004-131401596.jpg", disponible: true},
                {nombre: "OTG Tipo B (Micro)", precio: "$300 CUP", img: "https://i.ibb.co/SD0SWwyx/OTG-Tipo-B.jpg", disponible: true}
            ]
        },
        {
            nombre: "Memorias USB",
            precio: "Desde $2150 CUP",
            categoria: "almacenamiento",
            fotos: ["https://i.ibb.co/6cnpqPTr/1000218192.jpg", "https://i.ibb.co/Ngj3BB8w/1000159173.jpg"],
            descripcion: "Memorias de 32GB y 64GB.",
            disponible: true,
            variantes: [
                {nombre: "Memoria USB 32GB", precio: "$2150 CUP", img: "https://i.ibb.co/6cnpqPTr/1000218192.jpg", disponible: false},
                {nombre: "Memoria USB 64GB 3.0", precio: "---", img: "https://i.ibb.co/Ngj3BB8w/1000159173.jpg", disponible: false}
            ]
        },
        {
            nombre: "Adaptador para Micros SD",
            precio: "$200 CUP c/u",
            categoria: "almacenamiento",
            fotos: ["https://i.ibb.co/YFyX1rDQ/1000155412.jpg", "https://i.ibb.co/twJFPHTy/1000158551.jpg"],
            descripcion: "Adaptador est√°ndar para leer tarjetas Micro SD en ranuras SD.",
            disponible: true
        },
        {
            nombre: "Discos duros",
            precio: "---",
            categoria: "almacenamiento",
            fotos: ["https://i.ibb.co/HfH5N9nT/1000190920.jpg"],
            descripcion: "",
            disponible: false
        },
        {
            nombre: "Mouse",
            precio: "---",
            categoria: "pc",
            fotos: ["https://i.ibb.co/m7h8RxX/1000229163.jpg", "https://i.ibb.co/D3Bq9CB/1000229162.jpg"],
            descripcion: "",
            disponible: false
        },
        {
            nombre: "Medias",
            precio: "$350 CUP",
            categoria: "otros",
            fotos: ["https://i.ibb.co/bMTy9Hxh/1000146970.jpg", "https://i.ibb.co/zhHS8dKD/1000146969.jpg"],
            descripcion: "Diferentes tallas y modelos disponibles.",
            disponible: true
        },
        {
            nombre: "Mangas para el sol",
            precio: "$800 CUP el par",
            categoria: "otros",
            fotos: ["https://i.ibb.co/RGpLkX27/1000146437.jpg", "https://i.ibb.co/WW6cXZbT/1000147486.jpg", "https://i.ibb.co/BVC4JGWm/1000147487.jpg"],
            descripcion: "Color disponibles blanco",
            disponible: true
        },
        {
            nombre: "Mata moscas",
            precio: "$200 CUP c/u",
            categoria: "otros",
            fotos: ["https://i.ibb.co/2fG8xqB/1000173994.jpg", "https://i.ibb.co/6J4XR66G/1000146733.jpg", "https://i.ibb.co/mVFjQ7ng/1000146732.jpg"],
            descripcion: "",
            disponible: true
        }
    ];

    // ==========================================
    // L√ìGICA DE LA TIENDA
    // ==========================================

    let carrito = [];

    window.addEventListener('load', function() {
        const container = document.getElementById('productosContainer');
        container.innerHTML = '';

        productosData.forEach((p, index) => {
            const fotosJson = JSON.stringify(p.fotos).replace(/"/g, '&quot;');
            let botonHtml = '';

            if (!p.disponible) {
                botonHtml = '<button class="btn-agotado">Agotado</button>';
            } else if (p.variantes) {
                const variantesJson = JSON.stringify(p.variantes).replace(/"/g, '&quot;');
                botonHtml = `<button class="btn-whatsapp" onclick="abrirSelector('${p.nombre}', ${variantesJson})">Seleccionar</button>`;
            } else {
                botonHtml = `<button class="btn-whatsapp" onclick="agregarAlCarrito(this, '${p.nombre}', '${p.precio}', '${p.fotos[0]}')">Me interesa</button>`;
            }

            const badgeHtml = p.fotos.length > 1 
                ? `<span class="badge-fotos">${p.fotos.length} fotos</span>` 
                : (p.variantes ? '<span class="badge-fotos">Var√≠a</span>' : '');

            const descripcionAttr = p.descripcion.replace(/"/g, '&quot;');
            const html = `
                <div class="producto ${p.categoria}">
                    <div class="img-container" onclick="abrirCarrusel(${fotosJson})">
                        <img src="${p.fotos[0]}" loading="lazy">
                        ${badgeHtml}
                    </div>
                    <h3>${p.nombre}</h3>
                    <span class="precio">${p.disponible ? p.precio : '---'}</span>
                    <button class="btn-descripcion" onclick="verDescripcion('${p.nombre}', '${descripcionAttr}')">Descripci√≥n</button>
                    ${botonHtml}
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        });
    });

    function enviarPeticion() {
        const texto = document.getElementById("textoPeticion").value;
        if (texto.trim() === "") { alert("Por favor, escribe algo antes de enviar."); return; }
        const mensaje = encodeURIComponent("Hola, necesito lo siguiente: " + texto);
        window.location.href = "https://wa.me/5358811896?text=" + mensaje;
    }

    async function compartirTienda() {
        const shareData = { title: 'Mi tienda online', text: 'Mira estos productos disponibles en mi tienda', url: window.location.href };
        try { if (navigator.share) { await navigator.share(shareData); } else { copiarAlPortapapeles(window.location.href); } } catch (err) {}
    }

    function copiarAlPortapapeles(texto) {
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(texto).then(() => alert("¬°Enlace copiado!")).catch(() => fallbackCopiar(texto));
        } else { fallbackCopiar(texto); }
    }

    function fallbackCopiar(texto) {
        const textArea = document.createElement("textarea");
        textArea.value = texto; textArea.style.position = "fixed"; textArea.style.left = "-9999px";
        document.body.appendChild(textArea); textArea.focus(); textArea.select();
        try { document.execCommand('copy'); alert("¬°Enlace copiado!"); } catch (err) { alert("Error al copiar."); }
        document.body.removeChild(textArea);
    }

    function abrirCarrusel(listaFotos) {
        const modal = document.getElementById("miModal");
        const carrusel = document.getElementById("carrusel");
        const instruccion = document.getElementById("txtInstruccion");
        modal.classList.remove("modo-texto"); modal.style.display = "flex";
        carrusel.innerHTML = "";
        listaFotos.forEach(foto => {
            const div = document.createElement("div");
            div.className = "carrusel-item";
            div.innerHTML = `<img src="${foto}" loading="lazy">`;
            carrusel.appendChild(div);
        });
        instruccion.style.display = (listaFotos.length > 1) ? "block" : "none";
        carrusel.scrollLeft = 0;
    }

    function verDescripcion(nombre, texto) {
        const modal = document.getElementById("miModal");
        const carrusel = document.getElementById("carrusel");
        const instruccion = document.getElementById("txtInstruccion");
        modal.classList.add("modo-texto");
        let contenido = (!texto || texto.trim() === "") ? "Contactar para m√°s informaci√≥n." : texto;
        carrusel.innerHTML = `<div class="modal-text"><h2>${nombre}</h2><p>${contenido}</p></div>`;
        instruccion.style.display = "none"; modal.style.display = "flex";
    }

    function cerrarModal() { document.getElementById("miModal").style.display = "none"; }

    function filtrar(categoria, boton) {
        const botones = document.querySelectorAll('.btn-filtro');
        botones.forEach(b => b.classList.remove('activo'));
        boton.classList.add('activo');
        const productos = document.querySelectorAll('.producto');
        productos.forEach(p => {
            if (categoria === 'todos' || p.classList.contains(categoria)) { p.style.display = 'flex'; } 
            else { p.style.display = 'none'; }
        });
    }

    function abrirSelector(titulo, opciones) {
        let selectorModal = document.getElementById("modalSeleccion");
        if (!selectorModal) {
            selectorModal = document.createElement("div");
            selectorModal.id = "modalSeleccion";
            selectorModal.className = "modal modo-texto";
            selectorModal.innerHTML = `<span class="btn-cerrar" style="color:#333; background:rgba(0,0,0,0.1);" onclick="cerrarSeleccion()">&times;</span>
                <div class="selector-contenido"><h2 id="tituloSeleccion" class="selector-titulo">Seleccionar opci√≥n</h2><div class="tienda" id="listaOpciones"></div></div>`;
            document.body.appendChild(selectorModal);
        }
        const tituloEl = document.getElementById("tituloSeleccion");
        const lista = document.getElementById("listaOpciones");
        tituloEl.innerText = titulo; lista.innerHTML = "";
        
        opciones.forEach(op => {
            const div = document.createElement("div");
            div.className = "producto";
            const agotado = (op.disponible === false);
            if(agotado) { div.style.opacity = "0.6"; }
            const fotosJson = JSON.stringify([op.img]).replace(/"/g, '&quot;');
            div.innerHTML = `
                <div class="img-container" onclick="abrirCarrusel(${fotosJson})"><img src="${op.img}" loading="lazy"></div>
                <h3>${op.nombre}</h3>
                <span class="precio">${agotado ? 'Agotado' : op.precio}</span>
                ${agotado 
                    ? '<button class="btn-agotado">Agotado</button>' 
                    : `<button class="btn-whatsapp" onclick="agregarDesdeSelector(event, '${op.nombre}', '${op.precio}', '${op.img}')">Me interesa</button>`
                }`;
            lista.appendChild(div);
        });
        selectorModal.style.display = "flex";
    }

    function agregarDesdeSelector(event, nombre, precioTexto, imgUrl) {
        event.preventDefault(); event.stopPropagation();
        agregarAlCarrito(event.target, nombre, precioTexto, imgUrl);
        const oldText = event.target.textContent;
        event.target.textContent = "‚úì Agregado"; event.target.style.background = "var(--accent)";
        setTimeout(() => { event.target.textContent = oldText; event.target.style.background = "var(--whatsapp)"; }, 1500);
    }

    function cerrarSeleccion() { const m = document.getElementById("modalSeleccion"); if(m) m.style.display = "none"; }

    function agregarAlCarrito(boton, nombre, precioTexto, imgUrl) {
        if (boton) { animarVuelo(boton, imgUrl); }
        carrito.push({ nombre, precioTexto, imgUrl });
        actualizarContador();
    }

    function animarVuelo(boton, imgUrl) {
        const rectBtn = boton.getBoundingClientRect();
        const startX = rectBtn.left + rectBtn.width / 2;
        const startY = rectBtn.top + rectBtn.height / 2;
        const cartBtn = document.getElementById('btnCarritoFlotante');
        const rectCart = cartBtn.getBoundingClientRect();
        const endX = rectCart.left + rectCart.width / 2;
        const endY = rectCart.top + rectCart.height / 2;
        const img = document.createElement('img');
        img.src = imgUrl; img.className = 'fly-img';
        img.style.left = (startX - 50) + 'px'; img.style.top = (startY - 50) + 'px';
        document.body.appendChild(img);
        void img.offsetWidth;
        img.style.left = (endX - 50) + 'px'; img.style.top = (endY - 50) + 'px';
        img.style.width = '20px'; img.style.height = '20px'; img.style.opacity = '0';
        setTimeout(() => { img.remove(); }, 800);
    }

    function actualizarContador() {
        document.getElementById('contadorCarrito').innerText = carrito.length;
        const btn = document.getElementById('btnCarritoFlotante');
        btn.style.transform = "scale(1.2)";
        setTimeout(() => btn.style.transform = "scale(1)", 200);
    }

    function abrirCarrito() {
        const modal = document.getElementById('modalCarrito');
        const lista = document.getElementById('listaCarrito');
        const resumen = document.getElementById('resumenCarrito');
        const totalSpan = document.getElementById('totalPrecio');
        lista.innerHTML = ""; let total = 0;
        if (carrito.length === 0) {
            lista.innerHTML = '<p style="text-align:center; color:#777; margin-top:50px;">El carrito est√° vac√≠o</p>';
            resumen.style.display = "none";
        } else {
            carrito.forEach((item, index) => {
                const precioNum = parseInt(item.precioTexto.replace(/\D/g, '')) || 0;
                total += precioNum;
                const div = document.createElement('div');
                div.className = 'item-carrito';
                div.innerHTML = `<div class="item-info"><img src="${item.imgUrl}"><div class="item-detalles"><h4>${item.nombre}</h4><span>${item.precioTexto}</span></div></div><button class="btn-eliminar" onclick="eliminarDelCarrito(${index})">&times;</button>`;
                lista.appendChild(div);
            });
            totalSpan.innerText = total; resumen.style.display = "block";
        }
        modal.style.display = "flex";
    }

    function cerrarCarrito() { document.getElementById('modalCarrito').style.display = "none"; }
    function eliminarDelCarrito(index) { carrito.splice(index, 1); actualizarContador(); abrirCarrito(); }

    function enviarPedidoWhatsApp() {
        if (carrito.length === 0) return;
        let mensaje = "Hola, me interesa comprar los siguientes productos:%0A%0A";
        let total = 0;
        carrito.forEach(item => {
            mensaje += `- ${item.nombre} (${item.precioTexto})%0A`;
            const precioNum = parseInt(item.precioTexto.replace(/\D/g, '')) || 0;
            total += precioNum;
        });
        mensaje += `%0A*Total Estimado: $${total} CUP*`;
        window.location.href = "https://wa.me/5358811896?text=" + mensaje;
    }
</script>

</body>
</html>
